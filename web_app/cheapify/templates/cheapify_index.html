{% extends "cheapify_base.html" %}
{% block content %}
<div class="container text-center mt-5">
		<h1>Welcome to Cheapify!</h1>
		<form class="my-4" method="post" action="{{ url_for('.youtube_search') }}">
				<div class="input-group mb-3" style="max-width: 500px; margin: 0 auto;">
						<input type="text" class="form-control" name="youtube_query" placeholder="Search YouTube..." value="{{ youtube_query|default('') }}" required>
						<button class="btn btn-outline-secondary" type="submit">Search</button>
				</div>
		</form>
		{% if youtube_results is defined and youtube_results %}
		<div class="mb-4">
				<h5>Search Results</h5>
				<div class="table-responsive">
						<table class="table table-bordered table-hover align-middle mx-auto" style="max-width: 900px;">
								<thead class="table-light">
										<tr>
												<th>Title</th>
												<th>Description</th>
												<th>Views</th>
												<th>Published</th>
												<th>Length</th>
												<th>Download</th>
										</tr>
								</thead>
								<tbody>
								{% for video in youtube_results %}
										<tr>
												<td class="text-break">{{ video.title }}</td>
												<td class="text-break" style="max-width: 300px;">{{ video.description }}</td>
												<td>{{ video.view_count }}</td>
												<td>{{ video.published }}</td>
												<td>{{ video.length }}</td>
												<td>
														<form method="post" action="{{ url_for('.youtube_download') }}" style="display:inline;">
																<input type="hidden" name="video_id" value="{{ video.video_id }}">
																<input type="hidden" name="title" value="{{ video.title }}">
																<button type="submit" class="btn btn-sm btn-primary">Download</button>
														</form>
												</td>
										</tr>
								{% endfor %}
								</tbody>
						</table>
				</div>
		</div>
		{% endif %}

		{% if files %}
		<div class="mb-4">
			<h5>Your Audio Files</h5>
			<ul class="list-group" style="max-width: 600px; margin: 0 auto;">
			{% for file in files %}
					{% if file.endswith('.m4a') %}
					<li class="list-group-item d-flex justify-content-between align-items-center">
							<span>{{ file }}</span>
							<audio controls style="max-width: 300px;">
									<source src="{{ url_for('.serve_audio', filename=file) }}" type="audio/mp4">
									Your browser does not support the audio element.
							</audio>
					</li>
					{% endif %}
			{% endfor %}
			</ul>
		</div>
		{% endif %}
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('.static', filename='script.js') }}"></script>
{% endblock %}
